apiVersion: batch/v1
kind: CronJob
metadata:
  name: cj-showdang
  namespace: macro
spec:
  schedule: "40 21 * * *" # 6:30 AM UTC+9
  jobTemplate:
    spec:
      ttlSecondsAfterFinished: 100
      backoffLimit: 1
      template:
        spec:
          containers:
          - image: selenium/standalone-chrome
            name: macro-showdang
            command: ["bin/sh"]
            args:
              - "-c"
              - |
                sleep $((RANDOM % 90))
                set -e 
                apt-get update && apt-get install -y python3 python3-pip 
                pip3 install selenium webdriver-manager --break-system-package 
                python3 /app/macro-showdang.py 
            securityContext:
              runAsUser: 0
            volumeMounts:
              - name: macro-script-volume
                mountPath: /app/macro-showdang.py
                subPath: macro-showdang.py
            resources: {}
          volumes:
            - name: macro-script-volume
              configMap:
                name: cm-showdang
          dnsPolicy: ClusterFirst
          restartPolicy: Never
